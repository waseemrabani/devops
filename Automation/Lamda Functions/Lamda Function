import json
import boto3
import os

client = boto3.client('ec2')
AMI = os.environ['AMI']
INSTANCE_TYPE = os.environ['INSTANCE_TYPE']
KEY_NAME = os.environ['KEY_NAME']
SUBNET_ID = os.environ['SUBNET_ID']
ec2 = boto3.resource('ec2')


def lambda_handler(event, context):
    
    response = client.describe_instance_status(
        InstanceIds=[
            'i-083edd2e0c2dbfbce',
        ],
    )
 #intsance_status= response['InstanceStatuses']['InstanceStatus'][0]['status']
    #if intsance_status == 'failed'
   
    des_instance = client.describe_instances(
        InstanceIds=[
            'i-083edd2e0c2dbfbce',
        ]
    )
    public_ip = []    
    
    for reservation in des_instance['Reservations']:
        for instance in reservation['Instances']:
            public_ip.append(instance['PublicIpAddress'])
    
    print(public_ip)
    
    instance = ec2.create_instances(
        ImageId=AMI,
        InstanceType=INSTANCE_TYPE,
        KeyName=KEY_NAME,
        SubnetId=SUBNET_ID,
        MaxCount=1,
        MinCount=1
    )    
    print("New instance created:", instance[0].id)
    #return(response)
